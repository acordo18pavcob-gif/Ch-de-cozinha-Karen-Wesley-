<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chá de Cozinha — Lista de Presentes</title>
  <style>
    :root {
      --bg: #ffeef8;
      --card: #ffffff;
      --card-border: #ffcce7;
      --text: #333;
      --muted: #666;
      --line: #ffcce7;
      --primary: #ff77a9;
    }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; background: var(--bg); color: var(--text); }
    .wrap { max-width: 720px; margin: 0 auto; padding: 24px; }
    .card { background: var(--card); border:1px solid var(--card-border); border-radius: 16px; padding: 20px; box-shadow: 0 6px 20px rgba(255,192,203,0.2); }
    h1 { font-size: 28px; margin: 0 0 8px; color: #d6336c; text-align:center; }
    p.desc { color: #d6336c; margin:0 0 16px; text-align:center; font-size:16px; }
    .row { display:flex; gap:8px; margin: 12px 0; }
    input[type="text"] { flex:1; padding:12px 14px; border:1px solid var(--line); border-radius: 12px; font-size:16px; }
    button { padding: 12px 14px; border:0; border-radius:12px; font-weight:600; cursor:pointer; }
    button.primary { background: var(--primary); color:#fff; }
    button.ghost { background:#fff; border:1px solid var(--line); color: var(--text); }
    .list { list-style:none; padding:0; margin: 16px 0 0; }
    .item { display:flex; align-items:center; justify-content: space-between; gap:8px; border:1px solid var(--line); background:#fff; border-radius:12px; padding:12px 14px; margin-bottom:8px; }
    .gift { font-size:16px; transition: all 0.4s ease; }
    .item.reserved .gift { text-decoration: line-through; color:#d6336c; opacity:0.7; }
    .meta { color: var(--muted); font-size:12px; }
    .actions { display:flex; gap:6px; }
    .admin-bar { display:flex; gap:8px; align-items:center; justify-content: space-between; margin-top: 16px; }
    .hide { display:none; }
    .footer { color: var(--muted); font-size:12px; margin-top:16px; text-align:center; }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Chá de Cozinha Karen & Wesley</h1>
      <p class="desc">Nosso Chá de Cozinha está chegando! Escolha um presente e celebre conosco ❤️</p>

      <div class="row">
        <input id="giftInput" type="text" maxlength="100" placeholder="Ex.: Jogo de copos" />
        <button id="addBtn" class="primary">Confirmar presente</button>
      </div>

      <ul id="list" class="list"></ul>

      <div class="admin-bar">
        <div>
          <button id="adminToggle" class="ghost">Entrar como admin</button>
          <span id="adminBadge" class="meta hide">Admin conectado</span>
        </div>
        <div id="adminForm" class="hide">
          <input id="adminEmail" type="email" placeholder="Seu e‑mail" style="padding:8px;border:1px solid var(--line);border-radius:10px;" />
          <input id="adminPass" type="password" placeholder="Sua senha" style="padding:8px;border:1px solid var(--line);border-radius:10px;" />
          <button id="adminLogin" class="primary">Login</button>
          <button id="adminCancel" class="ghost">Cancelar</button>
        </div>
        <div id="adminControls" class="hide">
          <button id="adminLogout" class="ghost">Sair do admin</button>
        </div>
      </div>

      <p class="footer">Tudo é anônimo para os convidados. Apenas o admin pode editar/apagar qualquer item.</p>
    </div>
  </div>

  <script type="module">
    const firebaseConfig = {
      apiKey: "AIzaSyAwtJ2viqesV1lFD9pizw-N45UOh9IWpyg",
      authDomain: "cha-de-cozinha-karen.firebaseapp.com",
      databaseURL: "https://cha-de-cozinha-karen-default-rtdb.firebaseio.com",
      projectId: "cha-de-cozinha-karen",
      storageBucket: "cha-de-cozinha-karen.firebasestorage.app",
      messagingSenderId: "62105968231",
      appId: "1:62105968231:web:af3ba8b89a181608f2fec2"
    };

    const ADMIN_EMAIL = "karen_garcia1999@outlook.com";

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import { getAuth, signInAnonymously, onAuthStateChanged, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);

    const giftInput = document.getElementById('giftInput');
    const addBtn = document.getElementById('addBtn');
    const listEl = document.getElementById('list');

    const adminToggle = document.getElementById('adminToggle');
    const adminForm = document.getElementById('adminForm');
    const adminEmail = document.getElementById('adminEmail');
    const adminPass = document.getElementById('adminPass');
    const adminLogin = document.getElementById('adminLogin');
    const adminCancel = document.getElementById('adminCancel');
    const adminControls = document.getElementById('adminControls');
    const adminLogout = document.getElementById('adminLogout');
    const adminBadge = document.getElementById('adminBadge');

    let currentUser = null;
    let isAdmin = false;

    // Login anônimo automático para convidados
    signInAnonymously(auth).catch(console.error);

    onAuthStateChanged(auth, (user) => {
      currentUser = user;
      isAdmin = !!(user && user.email === ADMIN_EMAIL);
      refreshAdminUI();
    });

    function refreshAdminUI(){
      if (isAdmin) {
        adminBadge.classList.remove('hide');
        adminControls.classList.remove('hide');
        adminForm.classList.add('hide');
        adminToggle.textContent = 'Admin conectado';
        adminToggle.disabled = true;
      } else {
        adminBadge.classList.add('hide');
        adminControls.classList.add('hide');
        adminToggle.textContent = 'Entrar como admin';
        adminToggle.disabled = false;
      }
    }

    adminToggle.addEventListener('click', () => { adminForm.classList.toggle('hide'); });
    adminCancel.addEventListener('click', () => { adminForm.classList.add('hide'); adminEmail.value=''; adminPass.value=''; });

    adminLogin.addEventListener('click', async () => {
      const email = adminEmail.value.trim();
      const pass = adminPass.value.trim();
      if (!email || !pass) return alert('Preencha e-mail e senha.');
      try {
        await signInWithEmailAndPassword(auth, email, pass);
        isAdmin = (auth.currentUser?.email === ADMIN_EMAIL);
        if (!isAdmin) alert('Este usuário não é admin desta lista.');
        adminForm.classList.add('hide');
        refreshAdminUI();
      } catch(e){ alert('Falha no login: '+(e?.message||e)); }
    });

    adminLogout.addEventListener('click', async () => { try { await signOut(auth); signInAnonymously(auth); } catch(e){ alert('Erro ao sair'); } });

    addBtn.addEventListener('click', async () => {
      const text = giftInput.value.trim();
      if (!text) return alert('Digite o presente.');
      if (!currentUser) return alert('Conectando... tente novamente.');
      try {
        await push(ref(db,'presentes'), { text, owner: currentUser.uid, createdAt: Date.now() });
        giftInput.value='';
      } catch(e){ alert('Não foi possível adicionar.'); console.error(e); }
    });

    // Lista de presentes em tempo real
    onValue(ref(db,'presentes'), (snap)=>{
      const data = snap.val()||{};
      const entries = Object.entries(data).sort((a,b)=> (a[1].createdAt||0)-(b[1].createdAt||0));
      listEl.innerHTML='';
      for(const [id,item] of entries){
        const li = document.createElement('li'); li.className='item reserved';
        const txt = document.createElement('div'); 
        txt.className='gift';
        txt.textContent = item.text;
        li.appendChild(txt);

        const actions = document.createElement('div'); actions.className='actions';

        // Convidado pode excluir apenas o próprio presente
        if(currentUser && currentUser.uid === item.owner){
          const delBtn = document.createElement('button');
          delBtn.className='ghost';
          delBtn.textContent='Excluir';
          delBtn.onclick = async()=>{ try { await remove(ref(db,'presentes/'+id)); } catch(e){console.error(e);} };
          actions.appendChild(delBtn);
        }

        // Admin pode editar e excluir
        if(isAdmin){
          const editBtn = document.createElement('button');
          editBtn.className='ghost';
          editBtn.textContent='Editar (admin)';
          editBtn.onclick = async () => {
            const newText = prompt('Edite o presente:', item.text);
            if(newText && newText.trim()!==''){
              await update(ref(db,'presentes/'+id), { text: newText.trim() });
            }
          };
          actions.appendChild(editBtn);

          const delBtnAdmin = document.createElement('button');
          delBtnAdmin.className='ghost';
          delBtnAdmin.textContent='Excluir (admin)';
          delBtnAdmin.onclick = async()=>{ try { await remove(ref(db,'presentes/'+id)); } catch(e){console.error(e);} };
          actions.appendChild(delBtnAdmin);
        }

        li.appendChild(actions);
        listEl.appendChild(li);
      }
    });
  </script>
</body>
</html>
